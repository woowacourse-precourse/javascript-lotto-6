# 미션 - 로또

주어진 미션 요구사항에 맞추어 로또 어플리케이션을 구현합니다.

## 🤔 요구사항 리스트

- [x] 프로그램 시작 시 구입 금액을 입력받는다.
  - [x] 입력값이 잘못되었을 경우, 에러를 출력하고 그 부분부터 다시 입력받는다.
  - [x] 입력값은 1000원 단위로 입력받는다. 1000원으로 나누어 떨어지지 않을 경우 예외처리한다.
  - [x] 그 외의 예외 사항은 별도로 정한다.
- [x] 입력된 금액만큼 로또를 발행한다.
- [x] 발행한 로또 수량을 출력한다.
- [x] 발행한 각 로또의 번호를 형식에 맞춰 출력한다.
  - [x] 로또 번호는 배열의 형태로 출력한다.
  - [x] 번호를 오름차순으로 정렬하여 출력한다.
  - [x] 번호는 `, ` 를 기준으로 구분한다.
- [x] 사용자로부터 당첨 번호를 입력받는다.
  - [x] 입력값이 잘못되었을 경우, 에러를 출력하고 그 부분부터 다시 입력받는다.
  - [x] 입력값은 로또 숫자 범위 (1~45)이내의 자연수여야 한다.
  - [x] 입력값은 `,`를 기준으로 구분한다.
  - [x] 입력값에 중복된 숫자가 포함될 수 없다.
- [x] 사용자로부터 보너스 번호를 입력받는다.
  - [x] 보너스 번호는 로또 숫자 범위 (1~45) 이내의 자연수여야 한다.
  - [x] 보너스 번호는 설정된 당첨 번호와 중복될 수 없다.
- [x] 로또 시행 결과를 출력한다.
- [x] 3개 ~ 6개 일치 시 상금과 일치한 로또 갯수를 표로 출력한다.
  - [x] 당첨금은 천원 단위로 `,` 를 넣어 구분한다.
- [x] 총 수익률을 출력한다.
  - [x] 수익률은 소수점 둘째 자리에서 반올림한다. (ex: 100.0%, 51.5%)
  - [x] 수익률은 천 단위로 `,`로 구분한다. (ex: 1,000.0%)
- [x] 예외 상황 발생 시 `[ERROR]`로 시작하는 에러 문구를 출력해야 한다.

## 😠 이번 주차에 적용해볼 개선점

- 의사 결정에 근거 가지기
- 모듈의 독립성 확보하기 (떼다가 딴 데 끼워도 되도록 만들어보기)
- 유효성 검사는 View에서 값의 근본적 검사, 모델에서 구체적 로직에 관련된 검사
- 출력 형식에 관한 로직을 모아서 관리하기
- 오버엔지니어링하지 않기(?) => 좀 더 단순하고 직관적인 해결책을 고려해보기
- 트레이드오프를 생각하기
- 상수 관리하기
  - 한 곳에서만 쓰이는 상수는 별도 파일로 분리하지 말고 쓰이는 class 내에서 static 필드로 관리
  - 상수가 여러 곳에서 쓰이거나, 앞으로 그럴 가능성이 있을 경우 별도 파일로 관리
  - 상수 정의할 때 부분으로 정의하고 마지막에 합쳐서 내보내기
  - 상수 정의 시 Object.freeze 사용

## 🧐 실제 구현 사항 리스트

### 🎮 앱 세부 구현 사항

#### View

- [x] InputView, OutputView를 각각 구현하고, View에서 이를 활용한다.
- [x] InputView, OutputView는 각각 입/출력에 관한 가장 단순한 단위의 메서드와 유효성 검사를 제공한다.
  - [x] InputView에서는 입력값의 형태(숫자인지, 여러 개의 숫자로 이루어진 문자열인지 등)를 검사한다.
- [x] View에서는 비즈니스 로직에 연관된 입/출력 메서드를 제공한다.
  - [x] 구매 금액/당첨 번호/보너스 번호를 입력받고 형변환하여 반환
  - [x] 구매 결과를 출력
  - [x] 당첨 결과 통계를 출력
  - [x] 수익률을 출력

#### Controller

- [x] 컨트롤러에서는 View를 이용해 입력을 받고 이를 처리하며, 처리된 값을 다시 View로 넘겨 출력한다.
- [x] 앱에서 입력을 받는 부분(구매 금액, 당첨 번호, 보너스 번호)에서 오류가 발생할 시, 해당 부분을 다시 실행하여 **오류가 발생한 부분을 다시 입력받도록** 처리한다.
- [x] 구매금액을 입력받아 LottoPublisher로 넘기고, 반환받은 Lotto 인스턴스 배열을 LottoService에 세팅한 후 출력한다.
- [x] 당첨 번호와 보너스 번호를 입력받아 LottoService에 세팅한다.
- [x] LottoService로부터 계산된 매칭 결과와 수익률 값을 View로 넘겨 출력한다.

#### Models

##### LottoPublisher

- [x] 입력받은 구매 금액 값을 유효성 검사 후 필드에 할당한다.
  - [x] 예외가 발생할 경우 컨트롤러로 전파되어 예외 처리가 작동한다.
- [x] 구매 금액만큼의 로또 인스턴스를 생성하고 배열에 담아 반환한다.

##### LottoService

- [x] 입력받은 당첨 번호, 보너스 번호를 유효성 검사 후 필드에 할당한다.
  - [x] 예외가 발생할 경우 컨트롤러로 전파되어 예외 처리가 작동한다.
- [x] calculator의 계산 함수로 각 필드(당첨 번호, 보너스 번호, 구매한 로또 티켓)를 넘겨 계산값을 반환한다.

##### LottoResultCalculator

- [x] 각 등수별 당첨 횟수를 저장할 result 객체를 필드로 가진다.
- [x] 구매한 로또 티켓, 당첨 번호, 보너스 번호를 받아 각 로또의 당첨 결과를 계산하고 result를 업데이트한다.
- [x] 업데이트된 result 필드를 반환한다.
- [x] 인자로 받은 구매 금액과 업데이트된 result 필드를 토대로 각 등수별 당첨 금액을 합산해 수익률을 계산하여 반환한다.

#### Validators

##### InputViewValidator

- [x] **입력값이 적절한 형태인지 확인한다.**
  - [x] 입력값이 숫자인지 확인한다.
  - [x] 입력값이 정수인지 확인한다.
  - [x] 입력값이 양수인지 확인한다.
  - [x] 여러 숫자 문자열 입력값을 배열로 형변환하고, 각 요소에 대해 상기한 검사를 실행한다.

##### LottoValidator

- [x] **입력값이 비즈니스 로직에 합당한지 확인한다.**
  - [x] 로또 번호 혹은 당첨 번호가 1~45 범위 내인지, 6개로 구성되어있는지, 중복값이 없는지 확인한다.
  - [x] 보너스 번호가 1~45 범위 내인지, 당첨 번호와 중복되는지 확인한다.
  - [x] 구매 금액이 1000으로 나누어 떨어지는 수인지 확인한다.

#### Other Utils

##### MessageFormat

- [x] **주어진 값을 출력하기에 적절한 형태의 메세지로 변환한다.**
  - [x] 로또 구매 갯수를 'n개를 구매했습니다.'형태로 변환한다.
  - [x] 로또 티켓의 numbers를 [1, 2, 3, 4, 5, 6] 형태로 변환한다.
  - [x] 상금을 나타내는 숫자에 1000 단위로 쉼표(,)를 적용한다.
  - [x] 수익률을 나타내는 숫자에 1000 단위로 쉼표(,)를 적용하고, 소수점 첫 번째 자리까지 표시한다.
  - [x] 각 등수 별로 당첨 숫자 갯수, 보너스 매치 확인 여부, 상금, 당첨 로또 갯수를 표시하는 메세지로 변환한다.
  - [x] 수익률을 '총 수익률은 n%입니다.'형태로 변환한다.

### 🛠 설계 및 구조 변경 사항

- View에서 발생한 예외 외에도, 각 model의 유효성 검사에서 발생한 예외 또한 **예외 발생 후 재입력**이 가능하도록, **예외를 Catch하여 함수를 재실행하는 메서드를 View에서 Controller로 옮긴다.**
- LottoService가 calculator를 **직접 생성하는 대신 외부에서 주입받도록 한다.**
  - DI 적용 근거는 다음과 같다.
  - 서비스 레이어는 컨트롤러에 비해 자주 변경될 수 있는 비즈니스 로직을 포함하고 있기 때문에 DI를 통해 확장성과 유지보수성을 높이는 것이 유리하다고 판단
  - 비즈니스 로직을 포함하고 있으니 DI로 테스트 용이성을 더 확보하면 좋겠다고 판단함
  - 컨트롤러에는 DI를 적용하지 않은 이유 : 컨트롤러는 모델과 뷰를 연결시키고 데이터 흐름을 제어하는 역할이니까 복잡한 로직보다는 간단한 라우팅과 데이터 전달에 초점을 맞추기 때문에 DI의 필요성이 상대적으로 낮다. 또한, 지난번에 모든 의존성을 외부에서 주입받도록 처리했더니 **외부에서 컨트롤러로 주입되는 의존성이 너무 많아서 가독성이 좋지 않았음.** 컨트롤러는 어플리케이션의 진입점이므로 구성을 단순하게 유지할 필요가 있겠다고 판단했음

### 📝 테스트 작성 목록

- [x] **유닛 테스트**
  - [x] InputViewValidator 테스트 : 유효성 검사 성공, 실패 케이스 검증
  - [x] LottoValidator 테스트 : 구매 금액, 당첨 번호, 보너스 번호에 대한 유효성 검사 기능 검증
  - [x] MessageFormat 테스트 : 주어진 값이 올바른 형태의 메세지로 변환되는지 검증
  - [x] LottoPublisher 테스트 : 구매 금액 설정 기능, 로또 발행 기능 검증
  - [x] LottoService 테스트 : 당첨 번호, 보너스 번호 설정 기능 검증
  - [x] LottoResultCalculator 테스트 : 로또 당첨 결과 계산 기능, 수익률 계산 기능 검증
- [x] **통합 테스트**
  - [x] LottoService-LottoResultCalculator 통합 테스트 : 로또 당첨 결과 계산, 수익률 계산 테스트
  - [x] LottoGameController - LottoService - View 통합 테스트 : 각 등수의 당첨을 포함하는 여러 케이스에 대해 예상한 값이 반환 / 출력되는지 테스트
